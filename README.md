# 手机号归属地查询

基于Rust 2024 edition实现的高性能手机号归属地查询服务，使用二分查找算法提供毫秒级响应。

## 项目特性

- ⚡ **高性能**: 使用Rust编写，内存预加载，二分查找算法
- 📱 **全面支持**: 支持移动、联通、电信、广电及其虚拟运营商
- 🌐 **HTTP API**: RESTful API接口，支持多种查询方式
- 📊 **数据准确**: 归属地信息库定期更新，包含517258条手机号段记录

### 数据规模
- 归属地信息库文件大小：4557kb
- 归属地信息库最后更新：2025年02月
- 手机号段记录条数：517258

### 技术栈
- **Rust Edition**: 2024
- **Web框架**: actix-web 4.11.0
- **序列化**: serde 1.0.228
- **错误处理**: anyhow 1.0.100

## phone.dat文件格式
```
    | 4 bytes |                     <- phone.dat 版本号（如：1701即17年1月份）
    ------------
    | 4 bytes |                     <-  第一个索引的偏移
    -----------------------
    |  offset - 8            |      <-  记录区
    -----------------------
    |  index                 |      <-  索引区
    -----------------------
```
1. 头部为8个字节，版本号为4个字节，第一个索引的偏移为4个字节；
2. 记录区 中每条记录的格式为"<省份>|<城市>|<邮编>|<长途区号>\0"。 每条记录以'\0'结束；
3. 索引区 中每条记录的格式为"<手机号前七位><记录区的偏移><卡类型>"，每个索引的长度为9个字节；

## 环境要求

- Rust 1.85+ (支持2024 edition)
- phone.dat文件 (需放在项目根目录)

## 安装使用

### 编译运行
```bash
# 克隆项目
git clone <repository-url>
cd phone_data

# 安装依赖并运行
cargo run

# 生产环境构建
cargo build --release
```

### API使用示例

服务启动后默认在8080端口，以下是一些查询示例：

例如使用`18086834111`来测试:

```shell
# example1
curl --location --request GET 'http://127.0.0.1:8080/query2/18086834111'

-----------------------------output------------------------------------------
{
    "code": 1,
    "data": {
        "province": "四川",
        "city": "成都",
        "zip_code": "610000",
        "area_code": "028",
        "card_type": "中国电信"
    },
    "success": true,
    "result": "ok"
}
```
```shell

# example2
curl 'http://127.0.0.1:9001/query?phone=18086834111'

-----------------------------output------------------------------------------
{
    "code": 1,
    "data": {
        "province": "四川",
        "city": "成都",
        "zip_code": "610000",
        "area_code": "028",
        "card_type": "中国电信"
    },
    "success": true,
    "result": "ok"
}
```

## 测试

```bash
# 运行所有测试
cargo test

# 运行特定测试（带详细输出）
cargo test --package phone_data --test demo_test phone_test -- --nocapture

# 运行库测试
cargo test --lib
```

## 性能指标

- **查询响应时间**: < 1ms (内存查询)
- **服务并发**: 支持200个worker线程
- **数据加载**: 启动时一次性加载，无需后续IO
- **算法复杂度**: O(log n) 二分查找

## API文档

### 查询接口

#### 1. GET参数查询
```bash
curl 'http://127.0.0.1:8080/query?phone=18086834111'
```

#### 2. 路径参数查询
```bash
curl 'http://127.0.0.1:8080/query2/18086834111'
```

### 响应格式
```json
{
    "code": 0,
    "data": {
        "province": "四川",
        "city": "成都",
        "zip_code": "610000",
        "area_code": "028",
        "card_type": "中国电信"
    },
    "success": true,
    "result": "ok"
}
```

## 更新计划
1. 添加请求拦截器
2. 添加鉴权
3. 添加异常错误统一处理
